# جستجوی پیشرفته - mssql-server

==========================================

آزمایشگاه پایگاه داده

------------------------------------------

تهیه شده توسط `محمد خدادادی` زیر نظر `استاد فلاح` در دانشکده `شهید محمد منتظری`  

ما برای این که بتوانیم از دیتا بیس استفاده بکنیم باید قابلیت جستجو و برون بری اطلاعات را داشته باشیم جستجو به ما امکان واکاوی اطلاعات دیتا بیس را میدهد.  

> برای تست و تمرین ما از دیتا بیس uni که در کتاب نیز ذکر شده است استفاده میکنیم اگر تا کنون با این دیتا بیس مواجه نشده اید لطفا به بخش دیتا بیس uni مراجعه کرده و این دیتا بیس را ایجاد کنید.

برای شروع و استفاده از دیتا بیس `uni` شما باید از `use uni` استفاده کنید.  

در جلسه گذشته نحوه جستجو و دسته بندی اطلاعات را بررسی کرده ایم در این جلسه میخواهیم نحوه جستجو از چندین جدول را یادبگیریم  

خوب برای مثال ما اطلاعات دانشجویانی را نیاز داریم که نمره بالای 17 دارند برای به دست آوردن شماره دانشجویی این دانشجویان کافیست کوئری پایین را استفاده کنیم

`````````sql
select stNo from Grade
where grade>17 
`````````

برای به دست آوردن اطلاعات دانشجویان نیز کوئری پایین را اجرا میکرده ایم.  

`````````sql
select fname 'نام',lname 'نام خانوادگی'
from Student
`````````

حال اگر بخواهیم به مقصود خود برسیم به شکل زیر عمل میکنیم.  

`````````sql
select stNo, fname 'نام',lname 'نام خانوادگی'
from Student where stNo in(select stNo from Grade
where grade>17 )
`````````

در اینجا ما یک جستجو را انجام داده ایم و در شرط آن با استفاده از عبارت `in` چک میشود  

در جستجویی که در بین این عبارت است بررسی میشود که شماره دانشجویی مورد نظر ما موجود میباشد یا نه  

> میتوان به جای جستجو به عبارت `in` آرایه ای از مقادیر داد

اما اگر بخواهیم نمره دانشجو را نیز در خروجی داشته باشیم چه کار میشود کرد؟؟  

در این جا میشود گفت شما چاره ای ندارید که جداول را با هم دیگر ادقام کنید.  

- 

در sql ما پنج روش ادقام داریم.

- اولین جدول اصلی می باشد و بخش کمی از جدول دوم - `Left Join`
- دومین جدول اصلی می باشد و بخش کمی از جدول اول - `Right Join`
- رکرود های هر دو جدول با هم دیگر ادقام شوند - `Full Join`
- اشتراک بین دو جدول نمایش داده میشود - `Inner Join`
- ضرب رکورد های جداول - `Cross join`

- 

فرمت کلی دستورات جوین به شکل زیر میباشد

`````````sql
select * from [table_name]
[join]
on [ conditions]
`````````

به کوئری زیر دقت کنید

`````````sql
select Student.stNo 'شماره دانشجویی', Student.fname 'نام',Student.lname 'نام خانوادگی', Grade.grade 'نمره' from Student 
Left join Grade
on Student.stNo = Grade.stNo
where grade>17
`````````

در اینجا ما جدول اصلی را جدول اول که جدول دانشجویان میباشد در نظر گرفته ایم و نمره آن ها را از جدول نمره ها نمایش میدهیم  

.

حال اگر بخواهیم در همین مثال  ترمی که این نمره را نیز پاس کرده را داشته باشیم اطلاعات را از جدول دوم  می گیرم و بهتر است به صورت زیر عمل کنیم

`````````sql
select Grade.stNo 'شماره دانشجویی', Student.fname 'نام',Student.lname 'نام خانوادگی',  Grade.Term 'ترم', Grade.grade 'نمره' from Student 
right join Grade
on Student.stNo = Grade.stNo
where grade>17
`````````

خوب سوال پیش میاد حالا که چرا از `full join` استفاده نکردیم  

خوب فول جوین دو جدول رو ادقام میکنه  یعنی همه رکورد ها رو برای ما نگه میداره حتی اگر در جدول دوم مقدار نداشته باشند  

برای مثال ما توی جدول دانشجویان دانشجویی به نام مینا علی نیا داریم که نمره ای براش ثبت نشده حالا زمانی که میخوایم کوئری بگیریم رکورد مینا علی نیا نیز باقی میماند و حذف نمیشود ولی به جای فیلد نمره و ... که از جدول نمرات مشتق شده اند مقدار `null` قرار میگیرد.

`````````sql
select Grade.stNo 'شماره دانشجویی', Student.fname 'نام',Student.lname 'نام خانوادگی',  Grade.Term 'ترم', Grade.grade 'نمره' from Student 
full outer join Grade
on Student.stNo = Grade.stNo
`````````

اما خوب چطور میشه از این اتفاق جلو گیری کرد؟؟  

شما میتونید از `Inner join` استفاده کنید تا کسانی رو که نمره ای براشون ثبت نشده، توی جستجتون نمایش نده

`````````sql
select Grade.stNo 'شماره دانشجویی', Student.fname 'نام',Student.lname 'نام خانوادگی',  Grade.Term 'ترم', Grade.grade 'نمره' from Student 
inner join Grade
on Student.stNo = Grade.stNo
`````````

در انتها نیز `Cross join` رو بررسی میکنیم

>این نوع `join` غیر از مواردی که اطلاعات کمی موجود باشد توصیه نمیشود.

اگر بخواهیم بدانیم هر دانشجو چه درس هایی را باید پاس کنید از کوئری زیر استفاده میکنیم

`````````sql
select fname,lname,Name
from Student
cross join Course
`````````
