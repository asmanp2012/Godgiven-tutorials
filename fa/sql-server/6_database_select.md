# جستجو - mssql-server

==========================================

آزمایشگاه پایگاه داده

------------------------------------------

تهیه شده توسط `محمد خدادادی` زیر نظر `استاد فلاح` در دانشکده `شهید محمد منتظری`

ما برای این که بتوانیم از دیتا بیس استفاده بکنیم باید قابلیت جستجو و برون بری اطلاعات را داشته باشیم جستجو به ما امکان واکاوی اطلاعات دیتا بیس را میدهد.  

> برای تست و تمرین ما از دیتا بیس uni که در کتاب نیز ذکر شده است استفاده میکنیم اگر تا کنون با این دیتا بیس مواجه نشده اید لطفا به بخش دیتا بیس uni مراجعه کرده و این دیتا بیس را ایجاد کنید.

برای شروع و استفاده از دیتا بیس `uni` شما باید از `use uni` استفاده کنید.  
فرمت کلی جستجو به صورت زیر میباشد

`````````sql
SELECT [TOP n] <expression list> FROM <structure>.CASES  
[WHERE <condition expression>][ORDER BY <expression> [DESC|ASC]]  
`````````

برای جستجو به شکل ‍‍`select * from Student` عمل میکنیم.</br>
‍‍‍`*` به معنی همه فیلد های جدول میباشد که در مثال بالا ما همه فیلد ها و ردیف های جدول دانشجویان را جستجو کرده ایم  

اما در هنگامی که همه فیلد های آن را نیاز نداریم به شکل زیر جستجوی خودمان را انجام میدهیم

`````````sql
select fname,lname,cityCode,Tel
from Student
`````````

در صورتی که در خروجی ما موارد تکراری از یکی از فیلد ها داشته باشیم از ‍‍`distinct` قبل از ذکر فیلد استفاده میکنیم.  

در این صورت ردیف هایی که در آن از این فیلد تکرار داشته باشند را در خروجی نداریم مانند مثال زیر:

`````````sql
select distinct citycode
from Student
`````````

نکته دیگری که میتوان به آن اشاره کرد تغیر عنوان فیلد ها در خروجی میباشد ما میتوانیم با قرار دادن یک رشته بعد 

از فیلد ها عنوان آن ها را در خروجی تغیر بدهیم مانند مثال زیر:

`````````sql
select fname 'نام',lname 'نام خانوادگی'
from Student
`````````

حال که ما میتوانیم جستجو کنیم باید بدانیم که چگونه در جستجوی خود شرط قرار بدهیم برای این کار ابتدا یک جستجوی ساده با
 ‍`select * from Grade`
انجام میدهیم حال که مطمئن شدیم دیتای مناسبی در این جدول داریم شروع میکنیم به گذاشتن
 شرط در ابتدا میخواهیم کسانی را جستجو کنیم که معدل آن ها بیشتر از 17 شده است و به شکل زیر عمل میکنیم

`````````sql
select * from Grade
where grade>17 
`````````

در این جا جستجوی ما درست و صحیح است اما در صورتی که بخواهیم نمرات ترم ‍`92931` دانشجویی با شماره ‍`10` را مشاهده کنیم جستجوی زیر را استفاده میکنیم

`````````sql
select * from Grade
where term=92931 and stNo='10'
`````````

خوب بله همینطوری که مشاهده میکنید عبارت کلیدی `where` برای گذاشتن شرط و عبارت ‍‍‍‍`and` برای برقراری شرط دیگر استفاده میشود  

در گذاشتن شرط شما میتوانید از عبارات منطقی دیگری نیز مثل `>` `<` `like` `or` `not` و .. استفاده کنید.  

اما اگر ما بخواهیم جستجوی خود را بر اساس یک فیلد گروهی انجام بدهیم باید از از `group by` استفاده کنیم. این عبارت اطلاعات را به صورت دسته ای در اختیار ما قرار میدهد و ما میتوانیم روی این اطلاعات که بر اساس فیلدهای مورد نظرمان دسته بندی شده اند عملیات هایی مثل گرفتن تعداد - محاصبه جمع یا میانگین و ... انجام بدهیم

- از عبارت `avg` برای گرفتن معدل یک فیلد جستجو‍‍
- از عبارت `sum` برای محاصبه مجموع یک فیلد در جستجو
- از عبارت `count` برای محاصبه تعداد ردیف های جستجو

استفاده میکنیم
به مثال زیر دقت کنید:  

`````````sql
select stNo,count(*) 'تعداد نمرات دانشجو' from Grade
group by stNo
`````````

در مثال بالا ما تعداد نمرات هر دانشجو را با استفاده از `group by` و `count(*)` به دست میاوریم اما گاهی اوقات دانشجویان نمره ای ندارند اگر بخواهیم فقط دانش آموزانی را به دست بیاوریم که بیشتر از دو نمره داشته باشند کافیست برای `group by` توسط `having` شرط بگذاریم
به مثال زیر دقت کنید:  

`````````sql
select stNo,count(*),sum(grade),avg(grade) from Grade
group by stNo
having count(*)>2
`````````
